<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daftar â€” SkinCare.id</title>
  <link rel="stylesheet" href="/assets/css/resgister.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="login-container">
    <div class="login-card">
      <div class="logo">
        <div class="logo-icon">ğŸ’§</div>
        <h1 class="logo-text">SkinCare.id</h1>
      </div>

      <h2 class="card-title">Buat Akun Baru</h2>
      <p class="subtitle">Daftar untuk mulai perjalanan perawatan kulitmu âœ¨</p>

      <form id="registerForm" novalidate>
        <div class="form-group">
          <label for="name">Nama Lengkap</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="Nama lengkap"
          />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            autocomplete="email"
            required
            placeholder="contoh@email.com"
          />
        </div>

        <div class="form-group">
          <label for="password">Kata Sandi</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="password"
              name="password"
              autocomplete="new-password"
              required
              placeholder="Minimal 8 karakter"
            />
            <button type="button" class="toggle-password">ğŸ‘ï¸</button>
          </div>
        </div>

        <div class="form-group">
          <label for="confirm_password">Konfirmasi Kata Sandi</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="confirm_password"
              name="confirm_password"
              required
              placeholder="Ulangi kata sandi"
            />
            <button type="button" class="toggle-password">ğŸ‘ï¸</button>
          </div>
        </div>

        <button type="submit" class="btn-primary">Daftar</button>
      </form>

      <div class="divider">
        <span>atau</span>
      </div>

      <div class="social-login">
        <button class="btn-social btn-google">Google</button>
        <button class="btn-social btn-facebook">Facebook</button>
      </div>

      <div class="signup-prompt">
        Sudah punya akun? <a href="login.html" class="signup-link">Masuk</a>
      </div>
    </div>

    <div class="footer-note">
      Â© 2025 SkinCare.id â€¢ Privasi & Ketentuan
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  // INIT SUPABASE
  const supabase = supabase.createClient(
    "https://bnawrgrhmvkyzkixlbkc.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuYXdyZ3JobXZreXpraXhsYmtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NDA2MDUsImV4cCI6MjA4MTIxNjYwNX0.msUs2RMnJqAs086mkV4FTNIEOHb_3i-hGX5B0sWtolg"
  );

  // TOGGLE PASSWORD
  document.querySelectorAll('.toggle-password').forEach(btn => {
    btn.addEventListener('click', function () {
      const input = this.previousElementSibling;
      input.type = input.type === 'password' ? 'text' : 'password';
      this.textContent = input.type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
    });
  });

  // REGISTER FORM
  document.getElementById("registerForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = this.name.value.trim();
    const email = this.email.value.trim();
    const password = this.password.value;
    const confirm = this.confirm_password.value;

    if (!name || !email || !password || !confirm) {
      alert("Semua field wajib diisi");
      return;
    }

    if (password.length < 8) {
      alert("Password minimal 8 karakter");
      return;
    }

    if (password !== confirm) {
      alert("Konfirmasi password tidak cocok");
      return;
    }

    // REGISTER KE SUPABASE AUTH
    const { data, error } = await supabase.auth.signUp({
      email,
      password
    });

    if (error) {
      alert(error.message);
      return;
    }

    // SIMPAN PROFILE USER
    const user = data.user;

    if (user) {
      const { error: profileError } = await supabase
        .from("profiles")
        .insert({
          id: user.id,
          nama: name
        });

      if (profileError) {
        console.error(profileError);
        alert("Gagal menyimpan profil");
        return;
      }
    }

    alert("Registrasi berhasil! Silakan cek email untuk verifikasi.");
    window.location.href = "login.html";
  });
</script>

</body>
</html>
